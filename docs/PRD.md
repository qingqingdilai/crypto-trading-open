# 多交易所策略自动化系统 PRD（产品需求文档）

## 一、概述
- 项目名称：多交易所策略自动化系统（Multi-Exchange Strategy Automation System）
- 目标用户：加密量化交易者、策略开发者、交易运维人员
- 核心价值：统一的多交易所适配、可配置的策略引擎、可观测与可运维的高可靠运行体验
- 支持交易所：Hyperliquid、Backpack、Lighter、Binance、OKX、EdgeX（按适配完成度分层）

## 二、问题与目标
- 问题
  - 多交易所接口差异大：签名、精度、限频、数据模型与订阅方式各不相同
  - 策略运行易受断线、精度、订单状态不一致等问题影响
  - 缺乏统一的可视化运行面板与清晰日志，定位问题困难
- 目标
  - 提供标准化的交易所接口抽象与高质量适配
  - 提供网格、刷量、套利监控、价格提醒、波动率扫描等可配置系统
  - 提供运行时终端 UI、结构化日志、健康检查、自动重连、退出清理

## 三、人物画像
- 量化交易者（核心）
  - 诉求：快速配置并运行策略，关注收益稳定性与风控
- 策略工程师（次要）
  - 诉求：清晰的接口契约、可测试的模块边界、易调试
- 运维人员（辅助）
  - 诉求：可观测性（日志、指标）、一键启动/停止、自动恢复

## 四、范围与功能
- 网格交易系统（Grid Trading）
  - 模式：普通网格、马丁网格、价格移动网格（Follow）
  - 智能功能：剥头皮、智能剥头皮、本金保护、止盈、价格锁定、止损保护、退出清理
  - 健康检查：订单快照对比、位置容差、自动修复
  - 终端 UI：实时展示价格、网格、持仓、订单、APR 等
  - 现货预留：现货币种预留（手续费/余额管理）
- 刷量交易系统（Volume Maker）
  - 模式：Backpack 挂单；Lighter 市价（支持 Backpack/Hyperliquid 作为信号源）
  - 逻辑：价格稳定检测、订单簿条件、方向策略、滑点保护、client_id 精确跟踪
- 套利监控系统（Arbitrage Monitor）
  - 监控：多交易所价差、资金费率差、机会评分与持续时间
  - 终端 UI：排行、动态精度、声音提醒、智能排序
- 价格提醒系统（Price Alert）
  - 监控：价格突破上下限、窗口波动幅度
  - 通知：声音提醒、冷却机制、报警历史
- 网格波动率扫描器（Volatility Scanner）
  - 模拟：虚拟网格、实时 APR 计算、评级系统（S/A/B/C/D）
- 交易所适配层（Exchange Adapters）
  - 统一接口：行情、订单、持仓、订阅、用户流
  - 连接管理：自动重连、心跳、限频、精度与符号转换
- 基础设施
  - 依赖注入（DI）、日志系统、配置系统（YAML）、数据聚合、事件系统

## 五、关键用户故事（示例）
- 作为量化交易者，我可以：
  - 使用现成配置 `config/grid/*.yaml` 启动 Lighter BTC 做多网格：
    - `python3 run_grid_trading.py config/grid/lighter-long-perp-btc.yaml`
  - 在 Lighter 以市价刷量，信号源来自 Hyperliquid：
    - `python3 run_lighter_volume_maker.py config/volume_maker/lighter_volume_maker.yaml`
  - 运行套利监控并在出现机会时得到醒目提醒：
    - `python3 run_arbitrage_monitor.py`
  - 监控 Binance 现货价格突破范围并响铃提醒：
    - `python3 run_price_alert.py config/price_alert/binance_alert.yaml`
  - 扫描高 APR 的标的并按评级排序：
    - `python3 grid_volatility_scanner/run_scanner.py`

## 六、非功能需求（NFR）
- 性能
  - 市场数据优先使用 WebSocket；退化到 REST 时保证限频与重试
  - 单策略循环内最小化 REST 次数（如 volume maker 的 client_id + WS 优先）
- 可靠性
  - 断线自动重连；心跳检测；健康检查快照 >= 2；退出清理保证一致性
- 精度一致性
  - 使用 Decimal；统一 price_decimals/quantity_precision；下单与查询一致对齐
- 可观测性
  - 结构化日志（模块化 logger）；关键指标输出（订单成功率、重连次数、延迟）
- 安全
  - API Key 从环境变量或私有配置读取；不写入日志；避免泄露
- 可维护性
  - 分层与接口隔离；配置可读性；测试入口脚本清晰

## 七、依赖与约束
- 交易所差异：签名、时间戳、精度、订单模型、费率、符号格式
- Lighter SDK 限制：逐仓/杠杆需在网页端设置，脚本读取但不更改
- 订单/数量/价格精度：由交易所/交易对决定，必须在配置中显式设置
- 网络环境：WebSocket 稳定性与时延影响策略表现
- 订单速率与限频：各交易所不同，必须在适配层处理

## 八、成功度量（KPI）
- 策略运行时长（无中断）
- WebSocket 可用率与自动重连成功率
- 订单创建/撤单成功率与平均确认时延
- 价格移动网格的价格区间与订单匹配一致性
- Volume Maker 单轮 REST 调用次数（优化前后对比）
- 用户反馈：易用性与可观测性（UI、日志）

## 九、超出范围（当前版本）
- 实盘资金托管；风控审批流；中心化监控平台
- 跨账户与多实例分布式调度
- 回测/仿真框架（当前提供虚拟网格模拟作为轻量分析）

## 十、假设
- 用户具备基础 API Key 使用能力与基本交易知识
- 目标机器具备稳定网络与 Python 环境
- 初期主要聚焦永续合约（现货仅做多）

